- name: Firewall | Install custom firewalld services
  ansible.builtin.copy:
    src: 'firewall/{{ item }}.xml'
    dest: '/etc/firewalld/services/{{ item }}.xml'
    owner: root
    group: root
    mode: '0644'
  with_items:
    - bazarr
    - deluge
    - homeassistant
    - jackett
    - radarr
    - sonnar
  register: firewall_service_installed

- name: Firewall | Reload firewalld
  ansible.builtin.systemd:
    name: firewalld
    state: reloaded
  when: firewall_service_installed.changed

- name: Firewall | Open ports
  ansible.posix.firewalld:
    zone: public
    service: '{{ item }}'
    permanent: true
    immediate: true
    state: enabled
  with_items:
    - bazarr
    - deluge
    - homeassistant
    - jackett
    - plex
    - radarr
    - samba
    - sonnar
