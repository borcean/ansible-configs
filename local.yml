- name: Run base play
  hosts: all
  tags: base
  become: true
  roles:
    - base

- name: Run workstation play
  hosts: workstation
  tags: workstation
  become: true
  roles:
    - workstation

- name: Run ThinkPad play
  hosts: thinkpad
  tags: thinkpad
  become: true
  roles:
    - thinkpad


- name: End of run cleanup and reporting
  hosts: all
  become: true
  tasks:
    - name: Send completion alert
      ansible.builtin.include_tasks: playbooks/send_completion_alert.yml
      tags: always
      when:
        - task_failed is not defined

    - name: Send failure alert
      ansible.builtin.include_tasks: playbooks/send_failure_alert.yml
      tags: always
      when:
        - task_failed is defined
        - task_failed | bool
